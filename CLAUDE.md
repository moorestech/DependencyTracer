# DependencyTracer - Unity依存関係追跡ツール

## 概要
DependencyTracerは、Unityプロジェクト内のアセット間の依存関係を視覚的に表示・追跡するためのエディタ拡張ツールです。

## プロジェクト構造

```
Assets/
├── Editor/
│   ├── Core/
│   │   ├── DependencyDatabase.cs      # 依存関係データベースの管理
│   │   ├── AssetChangeDetector.cs     # アセット変更の自動検知
│   │   └── DependencyData.cs          # データの保存・読み込み（Data/に配置）
│   ├── Data/
│   │   └── DependencyData.cs          # 依存関係データの保存形式定義
│   ├── UI/
│   │   ├── AssetItem.cs               # メインビューのアセット表示
│   │   └── DependencyInfo.cs          # 個別の依存関係表示
│   ├── Utils/
│   │   ├── AssetUtils.cs              # アセット関連のユーティリティ
│   │   └── GUIUtils.cs                # GUI描画関連のユーティリティ
│   ├── DependencyViewerWindow.cs      # メインウィンドウ
│   ├── DependencyTracerExporter.cs    # DLLエクスポート機能
│   └── DependencyTracer.asmdef        # アセンブリ定義ファイル
└── DependencyTracerPackages/          # DLL出力先フォルダ
```

## 主な機能

### 1. 依存関係の可視化
- **依存先表示**: 選択したアセットが依存している他のアセット
- **参照元表示**: 選択したアセットを参照している他のアセット
- **階層表示**: 依存関係を階層的に展開可能

### 2. データベース管理
- **自動更新**: アセットの変更を検知して自動的にデータベースを更新
- **全体解析**: プロジェクト全体の依存関係を一括解析
- **永続化**: データベースは`Library/DependencyTracerDB.dat`に保存

### 3. UI機能
- **アイコン表示**: アセットタイプごとのアイコンを表示（サイズ調整済み）
- **コンテキストメニュー**: 右クリックでパスコピー、エクスプローラー表示など
- **フィルタリング**: 依存先/参照元の表示切り替え
- **サイズ表示**: アセットのファイルサイズを表示

### 4. エクスポート機能
- **DLL出力**: ソースコードをDLLとしてエクスポート
- **ドキュメント**: XMLドキュメント、デバッグシンボルの同梱オプション
- **README生成**: 使用方法を記載したREADMEファイルを自動生成

## 使用方法

### 基本的な使い方
1. `Window → Dependency Tracer` でウィンドウを開く
2. プロジェクトビューでアセットを右クリック → `Show Dependencies`
3. 依存関係が階層表示される

### 初回セットアップ
1. ウィンドウを開いて「全体解析」ボタンをクリック
2. プロジェクト全体の依存関係データベースが構築される

### DLLエクスポート
1. `Tools → Dependency Tracer → Export as DLL`
2. 出力先を確認（デフォルト: `Assets/DependencyTracerPackages`）
3. 「DLLをエクスポート」ボタンをクリック

## 技術的な詳細

### データベース形式
- バイナリ形式で保存（高速な読み書き）
- GUID文字列として保存（Unity 2020.1以降のGUID型に対応）
- 依存関係と参照関係を双方向で管理

### パフォーマンス最適化
- 差分更新: 変更されたアセットのみを更新
- キャッシュ: メモリ上にデータベースを保持
- 遅延読み込み: 必要になるまでアセットをロードしない

### UI最適化
- アイコンサイズ: 16x16ピクセルに固定（見やすさとパフォーマンスのバランス）
- 階層展開: フォルダ形式で必要な部分のみ展開
- バッチ処理: 複数アセットの同時表示に対応

## 注意事項

1. **大規模プロジェクト**: 初回の全体解析には時間がかかる場合があります
2. **メモリ使用量**: 大量のアセットがある場合、メモリ使用量が増加します
3. **Unity バージョン**: Unity 2020.1以降で動作確認済み

## トラブルシューティング

### データベースが破損した場合
1. `Library/DependencyTracerDB.dat` を削除
2. Unityを再起動
3. 「全体解析」を再実行

### アセットが表示されない場合
1. アセットがプロジェクト内に存在するか確認
2. データベースが初期化されているか確認（DB情報ボタンで確認）
3. 必要に応じて「全体解析」を実行

## 開発者向け情報

### ビルド方法
```bash
# Unityエディタでプロジェクトを開く
# コンパイルエラーがないことを確認
# Tools → Dependency Tracer → Export as DLL でDLLを生成
```

### テスト方法
1. 新規Unityプロジェクトを作成
2. DLLを`Assets/Editor`にコピー
3. 基本機能が動作することを確認

### 拡張ポイント
- `AssetUtils`: 新しいアセットタイプのサポート追加
- `GUIUtils`: カスタムUI要素の追加
- `DependencyData`: データ形式の拡張（メタデータ追加など）

## ライセンス
MITライセンス

## 更新履歴
- 2024/06/23: 初版作成
  - 基本的な依存関係表示機能
  - データベース管理機能
  - DLLエクスポート機能
  - アイコンサイズ調整（1/5サイズ）